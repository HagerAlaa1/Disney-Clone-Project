Bootstrapper.bindDependencyImmediate(function(){var Bootstrapper=window["Bootstrapper"];var ensightenOptions=Bootstrapper.ensightenOptions;if(location.host.indexOf("kids")===-1&&location.hostname.indexOf("ngsingleissues.nationalgeographic.com")===-1)Bootstrapper.insertScript("https://secure.espn.com/js/dcf/tags/vision/latest/vision-media.js")},4161375,[4234880,4053064,4208975],637927,[645040,683385,763742],24);
Bootstrapper.bindDependencyImmediate(function(){var Bootstrapper=window["Bootstrapper"];var ensightenOptions=Bootstrapper.ensightenOptions;function startVision(visionConfigs,settings={}){const visionPromise=waitForGlobal("VISION").then(()=>{var guestInfo={status:__dataLayer.pzn?__dataLayer.pzn.login_status:undefined,entitlements:__dataLayer.pzn?__dataLayer.pzn.entitlements:undefined},userab_1=__dataLayer.pzn?__dataLayer.pzn.userab_1:undefined;var environment=Bootstrapper.ensightenOptions.publishPath;
visionConfigs.url="https://vision.fn-pz.com/v3/";if(environment.indexOf("stage")===0)visionConfigs.url="https://vision.fn-pzqa.com/v3/";else if(environment.indexOf("local")===0||environment.indexOf("sandbox")===0||environment.indexOf("dev")===0)visionConfigs.url="https://vision.fn-pzdev.com/v3/";if(typeof __espnfitt__!=="undefined"){visionConfigs.flushAtEventCount=25;visionConfigs.flushIntervalSec=30}VISION.setConfigs(visionConfigs);if(userab_1)VISION.addTest("userab_1",userab_1);var SWID=Bootstrapper.Cookies.get("SWID");
if(SWID!=null&&SWID!=""&&typeof SWID!=="undefined"){var loggedIn=SWID.indexOf("{")>=0;VISION.addGuestId(SWID,"swid",loggedIn,"primary")}if(guestInfo.entitlements!=null)guestInfo.entitlements.split(",").map(function(s){return s.trim()}).filter(function(s){return s!==""&&s!=="none"}).forEach(function(s){VISION.addSubscriptionId(s)});var did=typeof DisneyID!=="undefined"&&DisneyID.get();if(did)did.on("logout",function unsetSubs(){VISION.unsetAllSubscriptionId()});const vision=new VISION;window.vision=
vision;return vision});if(settings.skipEvents){if(!Array.isArray(window.__disneyCorePromises))window.__disneyCorePromises=[];window.__disneyCorePromises.push({name:"vision",promise:visionPromise})}else if(typeof __dataLayer!=="undefined"&&typeof __dataLayer.subscribe==="function")visionPromise.then(vision=>{var page=__dataLayer.page||{},subscriptions=__dataLayer.subscribedEventNames||[],hasVisionSubscription=subscriptions.includes("__dataLayer.vision.track"),visionPageUrl=page.page_url&&page.page_url!==
"/"?page.page_url:window.location.href;window.visionParams={event_name:"page_view",page_url:visionPageUrl,page_location:page.page_location,page_nav_method:page.page_nav_method,page_type:page.page_type};if(!window.visionQ)window.visionQ=new Bootstrapper.TrackQueue;window.visionQ.push(trackVision,{},window.visionParams);window.visionQ.runAll();if(!hasVisionSubscription)__dataLayer.subscribe("vision.track",function(_visionData){var visionData=_visionData||{};if(!visionData.event_name)visionData.event_name=
"pzncon";if(vision&&typeof vision.track==="function")trackVision(visionData);else window.visionQ.push(trackVision,{},visionData)})});function trackVision(visionData){if(vision&&typeof vision.track==="function"&&visionData)vision.track(visionData)}function waitForGlobal(varName,interval=100,timeout=1E4){return new Promise((resolve,reject)=>{const start=Date.now();const check=()=>{if(typeof window[varName]!=="undefined")resolve(window[varName]);else if(Date.now()-start>timeout)reject(new Error(`Timeout waiting for global: ${varName}`));
else setTimeout(check,interval)};check()})}}Bootstrapper.startVision=startVision},4196320,[4161375,4234880,4053064,4208975],778732,[637927,645040,683385,763742],24);
Bootstrapper.bindDependencyImmediate(function(){var Bootstrapper=window["Bootstrapper"];var ensightenOptions=Bootstrapper.ensightenOptions;let appId;let appSuite;let product;const _dl=window.__dataLayer||{};const site=_dl.site?_dl.site.site:undefined;switch(site){case "www.starwars.com":appId="starwars-web";appSuite=Bootstrapper.ensightenOptions.publishPath==="prod"?"wdgintrotw":"wdgintrotwdev";product="starwars";break;case "www.disney.com":default:appId="disney-web";appSuite=Bootstrapper.ensightenOptions.publishPath===
"prod"?"wdgintrotw":"wdgintrotwdev";product="disney.com"}const visionConfig={app_bundle_id:site,app_id:appId,app_platform:"web",app_suite:appSuite,app_version:"0",debugMode:!!window.debugMode,skipPrivacyValidation:true,url:""};if(["www.disney.com","www.starwars.com"].includes(site)){try{Bootstrapper.startVision(visionConfig,{skipEvents:true})}catch(error){console.log("VISION Error - Bootstrapper.startVision has an internal error: ",error)}try{Bootstrapper.startDisneyCore({enableExtensions:["vision"],
product:product})}catch(error){console.log("DisneyCore Error - Bootstrapper.startDisneyCore has an internal error: ",error)}}},4212031,[4208975,4196320,4221746],779215,[763742,778732,791102],24);
Bootstrapper.bindDependencyImmediate(function(){var Bootstrapper=window["Bootstrapper"];var ensightenOptions=Bootstrapper.ensightenOptions;(function(e,t){typeof exports==`object`&&typeof module<`u`?module.exports=t():typeof define==`function`&&define.amd?define([],t):(e=typeof globalThis<`u`?globalThis:e||self,e.DisneyCore=t())})(this,function(){let e=e=>{let t,n=new Set,r=(e,r)=>{let i=typeof e==`function`?e(t):e;if(!Object.is(i,t)){let e=t;t=(r==null?typeof i!=`object`||!i:r)?i:Object.assign({},
t,i),n.forEach(n=>n(t,e))}},i=()=>t,a={setState:r,getState:i,getInitialState:()=>o,subscribe:e=>(n.add(e),()=>n.delete(e))},o=t=e(r,i,a);return a},t=t=>t?e(t):e,n={Adult:`adult`,Minor:`minor`},r={Dev:`dev`,Qa:`qa`,Prod:`prod`},i={CollectionNotAllowed:`collectionNotAllowed`,PrivacyRulesNotAvailable:`privacyRulesNotAvailable`},a={dev:`https://vision.fn-pzdev.com/v3/collection/management`,qa:`https://vision.fn-pzqa.com/v3/collection/management`,prod:`https://vision.fn-pz.com/v3/collection/management`},
o={backoffMultiplier:2,baseDelay:2E3,maxDelay:3E4,maxRetries:5};function s(){return`${Date.now()}-${Math.floor(Math.random()*1E13)}`}function c(e,t){let n=e.concat(t),r=n.length,i=[7,11],a=[71,173],o=[2277735313,289559509],s=[1291169091,658871167];for(let e=0;e<r;e++)i=[(i[0]<<5)-i[0]+n.charCodeAt(e),(i[1]<<3)-i[1]+n.charCodeAt(e)],a=[(a[0]<<4)-a[0]+n.charCodeAt(e),(a[1]<<6)-a[1]+n.charCodeAt(e)],i=[i[0]^o[0],i[1]^o[1]],a=[a[0]^s[0],a[1]^s[1]];return`00000000${(i[0]>>>0).toString(16)}`.slice(-8)+
`00000000${(i[1]>>>0).toString(16)}`.slice(-8)+`00000000${(a[0]>>>0).toString(16)}`.slice(-8)+`00000000${(a[1]>>>0).toString(16)}`.slice(-8)}function l(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}function u(e){return Object.entries(e).reduce((e,[t,n])=>(n&&e.push(t),e),[]).join(`,`)}function d(e,t,n){return{Accept:`application/json`,Audience:e.audience,Authorization:c(n,`vision`),Categories:u(e.consentStatus),Location:e.location||`US`,Product:t,"Session-Id":n}}function f(e){"@babel/helpers - typeof";
return f=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},f(e)}function p(e,t){if(f(e)!=`object`||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||`default`);if(f(r)!=`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`);}return(t===`string`?String:Number)(e)}function m(e){var t=p(e,`string`);return f(t)==
`symbol`?t:t+``}function h(e,t,n){return(t=m(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]==null?{}:arguments[t];t%2?g(Object(n),!0).forEach(function(t){h(e,t,n[t])}):
Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function v(e,t=o.baseDelay,n=o.maxDelay,r=o.backoffMultiplier){let i=t*r**(e-1);return Math.min(i,n)}function y(e){return new Promise(t=>setTimeout(t,e))}async function b(e,t={}){let n=_(_({},o),t),r;for(let t=1;t<=n.maxRetries;t++)try{return await e()}catch(e){if(r=e,t===n.maxRetries)break;await y(v(t,
n.baseDelay,n.maxDelay,n.backoffMultiplier))}throw r;}function x(e,t){if(e==null)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}function S(e,t){if(e==null)return{};var n,r,i=x(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let C=[`__meta`];var w=class{constructor(e){this.config=e,this.baseUrl=a[e.environment]||
a.dev,this.sessionId=s()}async fetchPrivacyRules(e){var t=this;let n=d(e,t.config.product,t.sessionId);return b(async()=>{let e=await fetch(t.baseUrl,{method:`GET`,headers:n});if(!e.ok){let t={error:`Privacy API Error`,message:(await e.json().catch(()=>({}))).message||`HTTP ${e.status}`,statusCode:e.status,timestamp:(new Date).toISOString()};throw Error(JSON.stringify(t));}let r=await e.json();return t.validatePrivacyApiResponse(r)},t.config)}validatePrivacyApiResponse(e){if(!l(e))throw Error(`Invalid response: expected object`);
let t=e,{__meta:n}=t,r=S(t,C);if(n!==void 0){if(!l(n))throw Error(`Invalid response: __meta must be an object`);let {valid:e}=n;if(e!==void 0&&typeof e!=`boolean`)throw Error(`Invalid response: __meta.valid must be a boolean`);}for(let e in r){let t=r[e];if(!t.events||!t.properties)throw Error(`Invalid response: vendor ${e} missing events or properties`);let n=t.events,i=t.properties;if(!Array.isArray(n.drop)||!Array.isArray(i.drop))throw Error(`Invalid response: vendor ${e} missing drop arrays`);
}return r}updateConfig(e){this.config=_(_({},this.config),e),e.environment&&(this.baseUrl=a[e.environment]||a.dev)}getBaseUrl(){return this.baseUrl}},T=class{constructor(e,n,i){if(this._extensions=[],this._rules=t(()=>({})),e=e.toLowerCase(),Object.values(r).includes(e)){if(typeof n!=`string`||!n)throw TypeError(`Disney Core SDK: product argument is invalid`);if(!l(i)&&i!=null)throw TypeError(`Disney Core SDK: consentInfo argument is invalid`);}else throw TypeError(`Disney Core SDK: environment argument is invalid`);
this._environment=e,this._product=n,this._consentInfo=i,this._privacyApiClient=new w({environment:e,product:n}),this.removePrivateFields=this.removePrivateFields.bind(this),this._rules.subscribe(this._toggleExtensions.bind(this)),this._fetchPrivacyRules()}async _fetchPrivacyRules(){var e=this;if(e._consentInfo)try{let t=await e._privacyApiClient.fetchPrivacyRules(e._consentInfo);e._rules.setState(t)}catch(e){}}getConsentInfo(){return this._consentInfo}_getPrivacyItems(e){let t=this.getPrivacyRules(e);
return{events:t==null?void 0:t.events.drop.map(e=>e.toLowerCase()),properties:t==null?void 0:t.properties.drop.map(e=>e.toLowerCase())}}getPrivacyRules(e){if((typeof e!=`string`||e===``)&&e!=null)throw TypeError(`Disney Core SDK: vendor argument is invalid`);let t=this._rules.getState();return e?t[e]:t}logEvent(e,t,r,a){var o;if(typeof e!=`string`||!e)throw TypeError(`Disney Core SDK: eventName argument is invalid`);if(l(t)){if(!Array.isArray(r)&&r!=null)throw TypeError(`Disney Core SDK: extensions argument is invalid`);
if(typeof a!=`function`&&a!=null)throw TypeError(`Disney Core SDK: onFailure argument is invalid`);}else throw TypeError(`Disney Core SDK: event argument is invalid`);let s=((o=this._consentInfo)==null?void 0:o.audience)!==n.Adult;if(s||!Object.keys(this._rules.getState()).length){let n=s?i.CollectionNotAllowed:i.PrivacyRulesNotAvailable;a==null||a(e,t,n);return}this._extensions.forEach(n=>{let {extensionName:i}=n;if((r==null?void 0:r.includes(i))===!1)return;let a=this.removePrivateFields(e,t,i);
Object.keys(a).length&&n.logEvent(e,a)})}onPrivacyRulesUpdated(e){if(typeof e!=`function`)throw TypeError(`Disney Core SDK: listener argument is invalid`);return this._rules.subscribe(e)}registerExtension(e){if(!l(e))throw TypeError(`Disney Core SDK: extension argument is invalid`);this._extensions.some(({extensionName:t})=>t===e.extensionName)||(this._extensions.push(e),this._toggleExtensions(),this._consentInfo&&e.consentInfoUpdated(this._consentInfo,this._product))}removePrivateFields(e,t,n){let {events:r,
properties:i}=this._getPrivacyItems(n);return!r||!i||r.some(t=>t===`all`||t===e.toLowerCase())||i.includes(`all`)?{}:Object.entries(t).reduce((e,[t,n])=>(i.includes(t.toLowerCase())||(e[t]=n),e),{})}setConsentInfo(e){if(!l(e))throw TypeError(`Disney Core SDK: consentInfo argument is invalid`);this._consentInfo=e,this._toggleExtensions(),this._extensions.forEach(e=>e.consentInfoUpdated(this._consentInfo,this._product)),this._fetchPrivacyRules()}_toggleExtensions(){if(this._consentInfo&&this._consentInfo.audience!==
n.Adult){this._extensions.forEach(e=>e.disableCollection());return}this._extensions.forEach(e=>{let {events:t,properties:n}=this._getPrivacyItems(e.extensionName);!t||!n||(t.includes(`all`)||n.includes(`all`)?e.disableCollection():e.enableCollection())})}};return T.LogFailureReason=i,T.VisionExtension=class{constructor(e){this.extensionName=`vision`,this._vision=e}consentInfoUpdated(e,t){let n=Object.entries(e.consentStatus).reduce((e,[t,n])=>(n&&e.push(t),e),[]).join(`,`);if(n){var r,i;let a=`categories=${n}&audience=${e.audience}&location=${e.location}&product=${t}`;
(r=(i=this._vision.constructor).setCollectionHeader)==null||r.call(i,a)}else{var a,o;(a=(o=this._vision.constructor).deleteCollectionHeader)==null||a.call(o)}}disableCollection(){this._vision.constructor.setForceDisableCollection()}enableCollection(){this._vision.constructor.unsetForceDisableCollection()}logEvent(e,t){try{this._vision.track(_(_({},t),{},{event_name:e}))}catch(e){}}},T})},4230563,[4234880,4053064,4208975],791100,[645040,683385,763742],24);
Bootstrapper.bindDependencyImmediate(function(){var Bootstrapper=window["Bootstrapper"];var ensightenOptions=Bootstrapper.ensightenOptions;function startDisneyCore(disneyCoreConfig){var environment=Bootstrapper.ensightenOptions.publishPath;var dcEnv="prod";if(environment.indexOf("stage")===0)dcEnv="qa";else if(environment.indexOf("local")===0||environment.indexOf("sandbox")===0||environment.indexOf("dev")===0)dcEnv="dev";const coreSdk=new DisneyCore(dcEnv,disneyCoreConfig.product);if(disneyCoreConfig.enableExtensions.includes("vision"))window.__disneyCorePromises.filter(({name})=>
name==="vision").forEach(({promise})=>{promise.then(vision=>{VISION.setPropertiesOverride(coreSdk.removePrivateFields);coreSdk.registerExtension(new DisneyCore.VisionExtension(vision))})});let convertedFlags;const otPromise=new Promise(resolve=>{const check=()=>{let consentStateObj=Bootstrapper.getConsentState();if(consentStateObj.onetrust?.groupsFlags&&Object.keys(consentStateObj.onetrust.groupsFlags).length>0){const rawFlags=consentStateObj.onetrust?.groupsFlags||{};convertedFlags=Object.fromEntries(Object.entries(rawFlags).map(([key,
value])=>[key,value===1?true:false]));resolve()}else if(typeof OnetrustActiveGroups!=="undefined"&&OnetrustActiveGroups){const allGroupKeys=OnetrustActiveGroups.split(",").filter(Boolean);const result={};allGroupKeys.forEach(key=>{result[key]=true});convertedFlags=result;resolve()}else setTimeout(check,100)};check()});Promise.all([...window.__disneyCorePromises.map(({promise})=>promise),otPromise]).then(()=>{var country=Bootstrapper.cookieJar.country||"US";var isCDS=Bootstrapper.cookieJar.s_ensCDS===
"0"?"adult":"minor";coreSdk.setConsentInfo({audience:isCDS,consentStatus:convertedFlags,location:country});const unsubscribe=coreSdk.onPrivacyRulesUpdated(()=>{var page=__dataLayer.page;var url=page.page_url&&page.page_url!=="/"?page.page_url:window.location.href;var visionParams={page_url:url,page_location:page.page_location,page_nav_method:page.page_nav_method,page_type:page.page_type};coreSdk.logEvent("page_view",visionParams);unsubscribe()})})}Bootstrapper.startDisneyCore=startDisneyCore},4221746,
[4234880,4053064,4208975,4230563],791102,[645040,683385,763742,791100],24);